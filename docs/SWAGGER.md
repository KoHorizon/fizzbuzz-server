# Swagger/OpenAPI Documentation

This document explains the Swagger/OpenAPI documentation for the FizzBuzz REST API.

## Table of Contents

- [Quick Start for Reviewers](#quick-start-for-reviewers)
- [Viewing Documentation](#viewing-documentation)
- [API Specification](#api-specification)
- [For Contributors: Regenerating Documentation](#for-contributors-regenerating-documentation)
- [Annotation Reference](#annotation-reference)

## Quick Start for Reviewers

**The Swagger documentation files are already generated and committed** to this repository. You can view the API specification immediately without installing any tools.

**Generated Files:**
- `docs/swagger.json` - OpenAPI 2.0 spec in JSON format
- `docs/swagger.yaml` - OpenAPI 2.0 spec in YAML format

**To explore the API interactively (RECOMMENDED):**

Go to https://editor.swagger.io/ and import `docs/swagger.yaml` - this gives you the full Swagger UI with interactive endpoint testing.

**Note on OpenAPI Version**: This project uses **OpenAPI 2.0** specification (also known as Swagger 2.0), generated by go-swagger v0.32.3. While OpenAPI 3.x (versions 3.0, 3.1, 3.2) are the current standards, go-swagger does not support OpenAPI 3.x as of December 2025. The OpenAPI 2.0 specification is mature, well-supported, and fully adequate for documenting this REST API.

## Viewing Documentation

### Option 1: Online Swagger Editor (RECOMMENDED - No Installation)

**This is the best way to explore the API documentation.**

1. Go to [editor.swagger.io](https://editor.swagger.io)
2. Click "File" â†’ "Import file"
3. Upload `docs/swagger.yaml` from this repository

Or copy/paste the contents of `docs/swagger.yaml` into the editor.

**What you get:**
- **Interactive API explorer** - Try out API endpoints with real requests
- **Visual schema browser** - Navigate models and parameters easily
- **Request/Response examples** - See what actual calls look like
- **Validation** - Ensures the spec is correct
- **Collapsible sections** - Easy to navigate large APIs

### Option 2: Serve Locally with Swagger UI

If you have Go installed, you can serve an interactive Swagger UI:

```bash
make swagger-serve
```

Then open http://localhost:8081/docs in your browser.

### Option 3: Browse Raw YAML (Quick Reference Only)

View the `docs/swagger.yaml` file on GitHub or in your editor. 

**Note:** This shows the raw text specification. While YAML is more readable than JSON, it's still verbose. For proper API exploration and testing, use Option 1 or 2 above.

## API Specification

### Overview

The FizzBuzz API provides three main endpoints:

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/fizzbuzz` | POST | Generate a FizzBuzz sequence |
| `/statistics` | GET | Get the most frequent request |
| `/health` | GET | Health check |

### Example Usage

#### Generate FizzBuzz

```bash
curl -X POST http://localhost:8080/fizzbuzz \
  -H "Content-Type: application/json" \
  -d '{
    "int1": 3,
    "int2": 5,
    "limit": 15,
    "str1": "fizz",
    "str2": "buzz"
  }'
```

Response (200 OK):
```json
{
  "result": [
    "1", "2", "fizz", "4", "buzz",
    "fizz", "7", "8", "fizz", "buzz",
    "11", "fizz", "13", "14", "fizzbuzz"
  ]
}
```

Validation Error (400 Bad Request):
```json
{
  "error": "invalid parameters",
  "details": [
    "int1 must be greater than 0",
    "str2 cannot be empty"
  ]
}
```

#### Get Statistics

```bash
curl http://localhost:8080/statistics
```

Response (200 OK):
```json
{
  "most_frequent_request": {
    "int1": 3,
    "int2": 5,
    "limit": 15,
    "str1": "fizz",
    "str2": "buzz"
  },
  "hits": 42
}
```

#### Health Check

```bash
curl http://localhost:8080/health
```

Response (200 OK):
```json
{
  "status": "healthy"
}
```

## For Contributors: Regenerating Documentation

This section is for developers who want to modify the API and regenerate the documentation.

### Install go-swagger CLI

The project uses [go-swagger](https://github.com/go-swagger/go-swagger) for generating OpenAPI 2.0 specifications from code annotations.

```bash
# Install the swagger CLI tool
go install github.com/go-swagger/go-swagger/cmd/swagger@latest

# Verify installation
swagger version
```

### Generate Swagger Spec

After modifying handler annotations or request/response models:

```bash
# Generate both JSON and YAML formats
make swagger
```

This will update:
- `docs/swagger.json` - OpenAPI 2.0 spec in JSON format
- `docs/swagger.yaml` - OpenAPI 2.0 spec in YAML format

### Validate Spec

Ensure your generated spec is valid:

```bash
make swagger-validate
```

### Manual Generation

If you prefer not to use the Makefile:

```bash
# Generate JSON
swagger generate spec -o ./docs/swagger.json --scan-models

# Generate YAML
swagger generate spec -o ./docs/swagger.yaml --scan-models

# Validate
swagger validate ./docs/swagger.yaml
```

## Annotation Reference

### Supported Annotations

The project uses go-swagger's declarative comments for API documentation.

#### Package-level (docs/swagger.go)

```go
// Package classification FizzBuzz REST API
//
// Documentation for FizzBuzz API
//
//     Schemes: http, https
//     Host: localhost:8080
//     BasePath: /
//     Version: 1.0.0
//
// swagger:meta
package docs
```

#### Route Documentation

```go
// swagger:route POST /fizzbuzz fizzbuzz generateFizzBuzz
//
// Generate FizzBuzz Sequence
//
// Generates a customizable FizzBuzz sequence based on the provided parameters.
// Numbers divisible by int1 are replaced with str1, numbers divisible by int2
// are replaced with str2, and numbers divisible by both are replaced with str1+str2.
//
// Responses:
//   200: generateResponse
//   400: errorResponse
//   500: errorResponse
func (h *FizzBuzzHandler) Generate(w http.ResponseWriter, r *http.Request) {
    // handler implementation
}
```

#### Model Documentation

```go
// GenerateRequest represents input for FizzBuzz generation
// swagger:model
type GenerateRequest struct {
    // First divisor (must be > 0)
    // required: true
    // example: 3
    Int1 int `json:"int1"`
    
    // Second divisor (must be > 0)
    // required: true
    // example: 5
    Int2 int `json:"int2"`
    
    // Upper limit for the sequence (must be > 0 and <= 10000)
    // required: true
    // example: 15
    Limit int `json:"limit"`
    
    // Replacement string for multiples of int1
    // required: true
    // example: fizz
    Str1 string `json:"str1"`
    
    // Replacement string for multiples of int2
    // required: true
    // example: buzz
    Str2 string `json:"str2"`
}
```

#### Parameter Documentation

```go
// swagger:parameters generateFizzBuzz
type generateFizzBuzzParams struct {
    // FizzBuzz generation parameters
    // in: body
    // required: true
    Body GenerateRequest
}
```

#### Response Documentation

```go
// swagger:response generateResponse
type generateResponseWrapper struct {
    // in: body
    Body struct {
        // The generated FizzBuzz sequence
        // example: ["1", "2", "fizz", "4", "buzz"]
        Result []string `json:"result"`
    }
}
```

### Common Annotation Tags

| Tag | Description | Example |
|-----|-------------|---------|
| `swagger:meta` | Package-level metadata | Applied to docs package |
| `swagger:route` | Endpoint definition | Applied to handler methods |
| `swagger:model` | Data model | Applied to structs |
| `swagger:parameters` | Request parameters | Wrapper type for params |
| `swagger:response` | Response definition | Wrapper type for responses |
| `required` | Mark field as required | `// required: true` |
| `example` | Example value | `// example: fizz` |
| `minimum` | Minimum value | `// minimum: 1` |
| `maximum` | Maximum value | `// maximum: 10000` |

### Adding a New Endpoint

1. **Add handler with swagger:route annotation:**
   ```go
   // swagger:route GET /my-endpoint myTag operationID
   //
   // Short description
   //
   // Longer description with more details...
   //
   // Responses:
   //   200: myResponse
   //   400: errorResponse
   func MyHandler(w http.ResponseWriter, r *http.Request) { ... }
   ```

2. **Define request parameters (if needed):**
   ```go
   // swagger:parameters operationID
   type myEndpointParams struct {
       // in: body
       Body MyRequestType
   }
   ```

3. **Define response:**
   ```go
   // swagger:response myResponse
   type myResponseWrapper struct {
       // in: body
       Body MyResponseType
   }
   ```

4. **Regenerate spec:**
   ```bash
   make swagger
   make swagger-validate
   ```

## Troubleshooting

### Issue: "swagger: command not found"

**Solution**: Install the swagger CLI:
```bash
go install github.com/go-swagger/go-swagger/cmd/swagger@latest

# Ensure GOPATH/bin is in your PATH
export PATH="$PATH:$(go env GOPATH)/bin"
```

### Issue: "WARNING: No operations defined"

**Solution**: Ensure you have:
1. Added `swagger:route` annotations to handlers in your handler files
2. Defined response types with `swagger:response` annotations
3. The handler file is included in the build (not in `_test.go` files)
4. Run `make swagger` from the project root

### Issue: Models not showing in spec

**Solution**: Add the `swagger:model` annotation to your struct:
```go
// swagger:model
type MyModel struct { ... }
```

And ensure the model is referenced in a `swagger:response` or `swagger:parameters`.

### Issue: Invalid spec validation errors

**Common causes:**
1. **Circular references** - Models that reference each other in a loop
2. **Missing referenced types** - Ensure all types used in responses are defined
3. **Invalid field tags** - Check JSON tags match annotation expectations

**Solution**: Use `make swagger-validate` to see specific errors and fix them one by one.

## Additional Resources

- [go-swagger Documentation](https://goswagger.io/)
- [OpenAPI 2.0 Specification](https://swagger.io/specification/v2/)
- [Swagger Editor](https://editor.swagger.io/) - Online viewer and validator
- [go-swagger GitHub](https://github.com/go-swagger/go-swagger)
- [go-swagger Examples](https://github.com/go-swagger/go-swagger/tree/master/examples)

## Why OpenAPI 2.0?

This project uses OpenAPI 2.0 (Swagger) rather than OpenAPI 3.x because:

1. **Tool Support**: go-swagger (v0.32.3, June 2025) is a mature, stable tool that generates OpenAPI 2.0 specs from Go code annotations
2. **Sufficient for this API**: OpenAPI 2.0 fully supports all features needed to document this REST API
3. **Wide Compatibility**: OpenAPI 2.0 specs are still widely supported by API tools, clients, and platforms

For APIs requiring OpenAPI 3.x features (webhooks, improved callback support, enhanced schema composition), alternative tools like `swaggo/swag`, `oapi-codegen`, or manual spec writing would be considered.
